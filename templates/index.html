<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Animal Explorer</title>
    <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:ital,wght@0,700;1,400&family=DM+Sans:wght@400;500;600&display=swap" rel="stylesheet">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/react/18.2.0/umd/react.production.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/react-dom/18.2.0/umd/react-dom.production.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/babel-standalone/7.23.2/babel.min.js"></script>
    <style>
        :root {
            --ink: #1a1008;
            --parchment: #f5efe4;
            --sage: #5a7a5e;
            --sage-light: #7a9e7e;
            --ochre: #c8852a;
            --ochre-light: #e8a84a;
            --rust: #a84c2a;
            --mist: #e8f0e9;
            --card: #fdfaf5;
            --border: rgba(90,122,94,0.2);
        }

        * { box-sizing: border-box; margin: 0; padding: 0; }

        body {
            font-family: 'DM Sans', sans-serif;
            background: var(--parchment);
            background-image:
                url("data:image/svg+xml,%3Csvg width='60' height='60' viewBox='0 0 60 60' xmlns='http://www.w3.org/2000/svg'%3E%3Cg fill='none' fill-rule='evenodd'%3E%3Cg fill='%235a7a5e' fill-opacity='0.04'%3E%3Ccircle cx='30' cy='30' r='2'/%3E%3C/g%3E%3C/g%3E%3C/svg%3E");
            min-height: 100vh;
            color: var(--ink);
        }

        #root { min-height: 100vh; }

        /* Animations */
        @keyframes fadeUp {
            from { opacity: 0; transform: translateY(16px); }
            to { opacity: 1; transform: translateY(0); }
        }
        @keyframes imageReveal {
            from { opacity: 0; transform: scale(1.04); }
            to { opacity: 1; transform: scale(1); }
        }
        @keyframes spin {
            to { transform: rotate(360deg); }
        }
        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.4; }
        }
    </style>
</head>
<body>
<div id="root"></div>

<script type="text/babel">
{% raw %}
const { useState, useEffect, useCallback } = React;

// â”€â”€ Styles as JS objects â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
const S = {
    app: {
        maxWidth: 680,
        margin: '0 auto',
        padding: '40px 20px 80px',
    },
    header: {
        textAlign: 'center',
        marginBottom: 40,
    },
    h1: {
        fontFamily: "'Playfair Display', serif",
        fontSize: '2.8rem',
        color: '#1a1008',
        letterSpacing: '-1px',
        lineHeight: 1.1,
    },
    subtitle: {
        fontFamily: "'Playfair Display', serif",
        fontStyle: 'italic',
        color: '#5a7a5e',
        marginTop: 6,
        fontSize: '1.05rem',
    },
    searchRow: {
        display: 'flex',
        gap: 8,
        marginBottom: 16,
    },
    input: {
        flex: 1,
        padding: '13px 20px',
        border: '2px solid #d4c9b0',
        borderRadius: 50,
        fontSize: '1rem',
        fontFamily: "'DM Sans', sans-serif",
        background: '#fdfaf5',
        color: '#1a1008',
        outline: 'none',
        transition: 'border-color 0.2s',
    },
    btnRow: {
        display: 'flex',
        gap: 8,
        marginBottom: 28,
        flexWrap: 'wrap',
    },
    btn: (bg, shadow) => ({
        fontFamily: "'DM Sans', sans-serif",
        fontWeight: 600,
        fontSize: '0.95rem',
        border: 'none',
        borderRadius: 50,
        padding: '12px 22px',
        cursor: 'pointer',
        background: bg,
        color: 'white',
        boxShadow: shadow,
        transition: 'transform 0.15s, box-shadow 0.15s',
        letterSpacing: '0.1px',
    }),

    // Card
    card: {
        background: '#fdfaf5',
        borderRadius: 24,
        overflow: 'hidden',
        boxShadow: '0 12px 40px rgba(26,16,8,0.1), 0 1px 0 rgba(255,255,255,0.8) inset',
        border: '1px solid rgba(90,122,94,0.15)',
        marginBottom: 24,
        animation: 'fadeUp 0.4s ease forwards',
    },
    imageContainer: {
        width: '100%',
        height: 280,
        overflow: 'hidden',
        position: 'relative',
        background: '#e8e0d4',
    },
    image: {
        width: '100%',
        height: '100%',
        objectFit: 'cover',
        display: 'block',
        animation: 'imageReveal 0.5s ease forwards',
    },
    imagePlaceholder: {
        width: '100%',
        height: '100%',
        display: 'flex',
        alignItems: 'center',
        justifyContent: 'center',
        fontSize: '4rem',
        background: 'linear-gradient(135deg, #e8e0d0, #d4c9b8)',
        animation: 'pulse 1.5s ease infinite',
    },
    cardBody: {
        padding: '28px 32px 32px',
    },
    animalName: {
        fontFamily: "'Playfair Display', serif",
        fontSize: '2.2rem',
        color: '#1a1008',
        marginBottom: 20,
        lineHeight: 1.2,
    },
    factsGrid: {
        display: 'grid',
        gridTemplateColumns: '1fr 1fr',
        gap: 12,
    },
    fact: (wide, accent) => ({
        padding: '12px 16px',
        background: accent ? 'linear-gradient(135deg, rgba(90,122,94,0.1), rgba(200,133,42,0.08))' : '#f0ede6',
        borderRadius: 12,
        border: accent ? '1px solid rgba(90,122,94,0.2)' : '1px solid rgba(0,0,0,0.04)',
        gridColumn: wide ? '1 / -1' : 'auto',
    }),
    factLabel: {
        fontSize: '0.7rem',
        fontWeight: 600,
        textTransform: 'uppercase',
        letterSpacing: '0.9px',
        color: '#8b7355',
        marginBottom: 3,
    },
    factValue: (italic) => ({
        fontSize: '0.98rem',
        color: '#1a1008',
        fontWeight: 500,
        lineHeight: 1.4,
        fontFamily: italic ? "'Playfair Display', serif" : "'DM Sans', sans-serif",
        fontStyle: italic ? 'italic' : 'normal',
        color: italic ? '#5a7a5e' : '#1a1008',
    }),

    // Empty state
    empty: {
        background: '#fdfaf5',
        borderRadius: 24,
        padding: '60px 32px',
        textAlign: 'center',
        border: '2px dashed #d4c9b0',
        marginBottom: 24,
    },
    emptyEmoji: { fontSize: '3.5rem', display: 'block', marginBottom: 12 },
    emptyText: {
        fontFamily: "'Playfair Display', serif",
        fontStyle: 'italic',
        color: '#8b7355',
        fontSize: '1.1rem',
    },

    // Divider
    divider: {
        display: 'flex',
        alignItems: 'center',
        gap: 12,
        margin: '28px 0',
        color: '#b5a089',
        fontSize: '0.8rem',
        fontWeight: 600,
        textTransform: 'uppercase',
        letterSpacing: '1.5px',
    },
    divLine: { flex: 1, height: 1, background: '#e0d5c4' },

    // Favourites
    favsCard: {
        background: '#fdfaf5',
        borderRadius: 24,
        padding: '28px 32px',
        boxShadow: '0 8px 32px rgba(26,16,8,0.08)',
        border: '1px solid rgba(90,122,94,0.15)',
    },
    favsTitle: {
        fontFamily: "'Playfair Display', serif",
        fontSize: '1.4rem',
        color: '#1a1008',
        marginBottom: 16,
    },
    favItem: {
        display: 'flex',
        justifyContent: 'space-between',
        alignItems: 'center',
        padding: '12px 0',
        borderBottom: '1px solid #ede3d6',
    },
    favName: { fontWeight: 600, fontSize: '1rem' },
    favActions: { display: 'flex', gap: 6 },
    smallBtn: (bg, color) => ({
        fontFamily: "'DM Sans', sans-serif",
        fontWeight: 600,
        fontSize: '0.82rem',
        border: 'none',
        borderRadius: 50,
        padding: '7px 14px',
        cursor: 'pointer',
        background: bg,
        color: color,
        transition: 'transform 0.1s',
    }),
    noFavs: {
        fontFamily: "'Playfair Display', serif",
        fontStyle: 'italic',
        color: '#8b7355',
        fontSize: '0.95rem',
    },
    loader: {
        width: 24,
        height: 24,
        border: '3px solid #d4c9b0',
        borderTopColor: '#5a7a5e',
        borderRadius: '50%',
        animation: 'spin 0.8s linear infinite',
        margin: '0 auto',
    },
};

// â”€â”€ Components â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

function AnimalImage({ name }) {
    const [imageUrl, setImageUrl] = useState(null);
    const [loading, setLoading] = useState(true);

    useEffect(() => {
        setLoading(true);
        setImageUrl(null);
        fetch(`/animal/${encodeURIComponent(name)}/image`)
            .then(r => r.json())
            .then(data => {
                setImageUrl(data.image_url || null);
                setLoading(false);
            })
            .catch(() => setLoading(false));
    }, [name]);

    const emoji = {
        elephant: 'ğŸ˜', lion: 'ğŸ¦', giraffe: 'ğŸ¦’', penguin: 'ğŸ§', dolphin: 'ğŸ¬',
        tiger: 'ğŸ¯', koala: 'ğŸ¨', panda: 'ğŸ¼', cheetah: 'ğŸ†', gorilla: 'ğŸ¦',
        zebra: 'ğŸ¦“', hippo: 'ğŸ¦›', crocodile: 'ğŸŠ', kangaroo: 'ğŸ¦˜', flamingo: 'ğŸ¦©',
        wolf: 'ğŸº', bear: 'ğŸ»', fox: 'ğŸ¦Š', owl: 'ğŸ¦‰', eagle: 'ğŸ¦…',
        shark: 'ğŸ¦ˆ', whale: 'ğŸ³', octopus: 'ğŸ™', jellyfish: 'ğŸª¼', seahorse: 'ğŸ´',
        parrot: 'ğŸ¦œ', toucan: 'ğŸ¦', peacock: 'ğŸ¦š', hedgehog: 'ğŸ¦”', otter: 'ğŸ¦¦',
        chimpanzee: 'ğŸ’', orangutan: 'ğŸ¦§', lemur: 'ğŸ’', meerkat: 'ğŸ¾', wombat: 'ğŸ¾',
        jaguar: 'ğŸ†', leopard: 'ğŸ†', lynx: 'ğŸ±', hyena: 'ğŸ¾', rhinoceros: 'ğŸ¦',
        camel: 'ğŸª', llama: 'ğŸ¦™', bison: 'ğŸƒ', moose: 'ğŸ«', reindeer: 'ğŸ¦Œ',
    }[name] || 'ğŸ¾';

    return (
        <div style={S.imageContainer}>
            {loading ? (
                <div style={S.imagePlaceholder}>{emoji}</div>
            ) : imageUrl ? (
                <img src={imageUrl} alt={name} style={S.image} />
            ) : (
                <div style={{...S.imagePlaceholder, animation: 'none', fontSize: '5rem'}}>
                    {emoji}
                </div>
            )}
        </div>
    );
}

function AnimalCard({ animal }) {
    if (!animal) return (
        <div style={S.empty}>
            <span style={S.emptyEmoji}>ğŸŒ¿</span>
            <p style={S.emptyText}>Press a button to discover an animal</p>
        </div>
    );

    return (
        <div style={S.card} key={animal.name}>
            <AnimalImage name={animal.name.toLowerCase()} />
            <div style={S.cardBody}>
                <h2 style={S.animalName}>{animal.name}</h2>
                <div style={S.factsGrid}>
                    <div style={S.fact(false, false)}>
                        <div style={S.factLabel}>ğŸŒ Location</div>
                        <div style={S.factValue(false)}>
                            {Array.isArray(animal.location) ? animal.location.join(', ') : animal.location}
                        </div>
                    </div>
                    <div style={S.fact(false, false)}>
                        <div style={S.factLabel}>ğŸ•ï¸ Habitat</div>
                        <div style={S.factValue(false)}>{animal.habitat}</div>
                    </div>
                    <div style={S.fact(false, false)}>
                        <div style={S.factLabel}>ğŸ½ï¸ Diet</div>
                        <div style={S.factValue(false)}>{animal.diet}</div>
                    </div>
                    <div style={S.fact(false, false)}>
                        <div style={S.factLabel}>â³ Lifespan</div>
                        <div style={S.factValue(false)}>{animal.lifespan}</div>
                    </div>
                    {animal.name_of_young && animal.name_of_young !== 'Unknown' && (
                        <div style={S.fact(false, false)}>
                            <div style={S.factLabel}>ğŸ¼ Baby name</div>
                            <div style={S.factValue(false)}>{animal.name_of_young}</div>
                        </div>
                    )}
                    {animal.slogan && (
                        <div style={S.fact(true, true)}>
                            <div style={S.factLabel}>ğŸ’¡ Fun fact</div>
                            <div style={S.factValue(true)}>{animal.slogan}</div>
                        </div>
                    )}
                </div>
            </div>
        </div>
    );
}

function App() {
    const [animals, setAnimals] = useState([]);
    const [currentAnimal, setCurrentAnimal] = useState(null);
    const [favourites, setFavourites] = useState([]);
    const [search, setSearch] = useState('');
    const [loading, setLoading] = useState(false);
    const [index, setIndex] = useState(0);

    useEffect(() => {
        fetch('/animals').then(r => r.json()).then(setAnimals);
        loadFavourites();
    }, []);

    const fetchAnimal = (name) => {
        setLoading(true);
        fetch(`/animal/${encodeURIComponent(name)}`)
            .then(r => r.json())
            .then(data => { setCurrentAnimal(data); setLoading(false); })
            .catch(() => setLoading(false));
    };

    const nextAnimal = () => {
        if (!animals.length) return;
        fetchAnimal(animals[index % animals.length]);
        setIndex(i => i + 1);
    };

    const randomAnimal = () => {
        if (!animals.length) return;
        const name = animals[Math.floor(Math.random() * animals.length)];
        fetchAnimal(name);
    };

    const searchAnimal = () => {
        const name = search.toLowerCase().trim();
        if (!name) return;
        fetchAnimal(name);
    };

    const saveFavourite = () => {
        if (!currentAnimal) return;
        fetch('/favourites', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify(currentAnimal),
        }).then(r => r.json()).then(d => { alert(d.message); loadFavourites(); });
    };

    const loadFavourites = () => {
        fetch('/favourites').then(r => r.json()).then(setFavourites);
    };

    const removeFavourite = (name) => {
        fetch(`/favourites/${encodeURIComponent(name)}`, { method: 'DELETE' })
            .then(() => loadFavourites());
    };

    const btnHover = (e) => { e.currentTarget.style.transform = 'translateY(-2px)'; };
    const btnOut = (e) => { e.currentTarget.style.transform = 'translateY(0)'; };

    return (
        <div style={S.app}>
            <header style={S.header}>
                <h1 style={S.h1}>Animal Explorer</h1>
                <p style={S.subtitle}>Discover the wonders of the animal kingdom</p>
            </header>

            {/* Search */}
            <div style={S.searchRow}>
                <input
                    style={S.input}
                    placeholder="Search for any animal..."
                    value={search}
                    onChange={e => setSearch(e.target.value)}
                    onKeyDown={e => e.key === 'Enter' && searchAnimal()}
                    onFocus={e => e.target.style.borderColor = '#5a7a5e'}
                    onBlur={e => e.target.style.borderColor = '#d4c9b0'}
                />
                <button
                    style={S.btn('#8b7355', '0 4px 12px rgba(139,115,85,0.3)')}
                    onMouseEnter={btnHover} onMouseLeave={btnOut}
                    onClick={searchAnimal}
                >Search ğŸ”</button>
            </div>

            {/* Animal Card */}
            {loading ? (
                <div style={{...S.empty, padding: '40px'}}>
                    <div style={S.loader} />
                </div>
            ) : (
                <AnimalCard animal={currentAnimal} />
            )}

            {/* Controls */}
            <div style={S.btnRow}>
                <button
                    style={S.btn('#5a7a5e', '0 4px 12px rgba(90,122,94,0.3)')}
                    onMouseEnter={btnHover} onMouseLeave={btnOut}
                    onClick={nextAnimal}
                >Next Animal ğŸ¾</button>
                <button
                    style={S.btn('#c8852a', '0 4px 12px rgba(200,133,42,0.3)')}
                    onMouseEnter={btnHover} onMouseLeave={btnOut}
                    onClick={randomAnimal}
                >Random ğŸ²</button>
                <button
                    style={S.btn('#a84c2a', '0 4px 12px rgba(168,76,42,0.3)')}
                    onMouseEnter={btnHover} onMouseLeave={btnOut}
                    onClick={saveFavourite}
                >Save Favourite â­</button>
            </div>

            {/* Divider */}
            <div style={S.divider}>
                <div style={S.divLine} />
                â­ Favourites
                <div style={S.divLine} />
            </div>

            {/* Favourites */}
            <div style={S.favsCard}>
                {favourites.length === 0 ? (
                    <p style={S.noFavs}>No favourites saved yet!</p>
                ) : (
                    favourites.map((fav, i) => (
                        <div key={fav.name} style={{...S.favItem, borderBottom: i === favourites.length - 1 ? 'none' : '1px solid #ede3d6'}}>
                            <span style={S.favName}>{fav.name}</span>
                            <div style={S.favActions}>
                                <button
                                    style={S.smallBtn('#d6e8da', '#3a6b4a')}
                                    onClick={() => setCurrentAnimal(fav)}
                                >View</button>
                                <button
                                    style={S.smallBtn('#f0e0d4', '#a84c2a')}
                                    onClick={() => removeFavourite(fav.name)}
                                >Remove</button>
                            </div>
                        </div>
                    ))
                )}
            </div>
        </div>
    );
}

ReactDOM.createRoot(document.getElementById('root')).render(<App />);
{% endraw %}
</script>
</body>
</html>